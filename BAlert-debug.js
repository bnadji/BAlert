/*!
 * BAlert.js - v2.1 - 2018-01
 * 
 * Copyright (c) 2018 Behzad Nadji;
 * Licensed under the MIT license
*/
var BAlert=function(t,e,n,i,o){function r(){return{position:{X:"c",Y:"15%",staggerX:"~5px",staggerY:"5px"},title:{},content:{},mainButtons:[],exitButton:{icon:null,raw:null,text:"&times;",inlineStyle:"",visible:function(){return 0===Q.timeout||Q.timeout>3e3}},alertStart:{duration:500,delay:0,dir:"top",scale:0,rotate:0,func:"ease-in"},alertExit:{duration:350,delay:0,dir:"none",scale:0,rotate:0,func:"ease-out"},callbacks:{onDisplayBegin:null,onDisplayEnd:null,onExitBegin:null,onExitEnd:null,onResize:function(){k()},onTapOutside:function(t){return function(t){t!==BAlert.alertArray[BAlert.alertArray.length-1]||_||(Q.DEBUG&$&&console.log(J+" IS THE LAST ALERT ON THE STACK -- REMOVING"),V())}(t),!1},onTapInside:null},classPrefix:"bajs_",defaultClasses:{apply:!0,values:{containerDiv:"",alertBoxDiv:"border-radius:0.5rem;width:fit-content;max-width:80%;max-height:80%;font:1rem arial;border:1px solid;background-color:#eee;box-shadow:0px 10px 45px -2px rgba(0,0,0,0.75);",titleDiv:"padding:0.1rem .3rem .3rem;text-align:center",titleIcon:"vertical-align:middle;width:1.5rem;height:1.5rem;margin-top:2px",titleText:"vertical-align:middle;margin-left:2px;font-size:1rem;font-weight:bold",contentDiv:"display:flex;clear:both;padding:0.5rem;overflow:auto",contentIcon:"vertical-align:middle; margin-right:0.5rem;width:1rem;height:1rem;",contentText:"vertical-align:middle; display:table-cell;font-size:1rem",exitButton:"float:right;border:0;padding:0;line-height:0.8rem;background:transparent",exitButtonIcon:"width:1rem;height:1rem",exitButtonText:"font-size:1rem;line-height:0.5rem;vertical-align:top",mainButtonsDiv:"clear:both;text-align:center;padding:0.35rem;display:flow-root",mainButtonsIcon:"vertical-align:middle;width:1rem;height:1rem;margin-right:2px",mainButtonsText:"vertical-align:middle;margin:0 2px",mainButtons:"border-radius:0.5rem;padding:2px;margin: 0.1rem 0.2rem;font-size:0.85rem"}},inlineStyles:{containerDiv:"",alertBoxDiv:"",titleDiv:"",titleIcon:"",titleText:"",contentDiv:"",contentIcon:"",contentText:"",exitButton:"",mainButtonsDiv:"",exitButtonIcon:"",exitButtonText:"",mainButtons:"",mainButtonsIcon:"",mainButtonsText:""},iconsPath:"",startingZIndex:1e3,timeout:0,DEBUG:0}}function a(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function l(t){return t===Object(t)}function s(t){return Array.isArray(t)}function c(t){return l(t)&&!a(t)}function u(t){return Z[t]&&Z.splice(Z.indexOf(t),1),document.body.contains(t)?t.parentNode.removeChild(t):null}function f(t,e,n){window.addEventListener?window.addEventListener(t,e,n):window.attachEvent&&window.attachEvent("on"+t,e),Q.DEBUG&$&&console.log(J+" WINDOW CALLBACK ADDED: "+t)}function d(t,e){window.removeEventListener?window.removeEventListener(t,e):window.detachEvent&&window.detachEvent("on"+t,e),Q.DEBUG&$&&console.log(J+" WINDOW CALLBACK REMOVED: "+t)}function v(t){t&&(Q.DEBUG&$&&console.log(J+" SETTING SELF-DESTRUCT TIMER ("+t+"msec)"),setTimeout(function(){V()},t))}function p(t,e){t&&(Q.DEBUG&$&&console.log(J+" CALLBACK CALLED: "+e),t(H))}function g(t){return t*parseFloat(getComputedStyle(document.documentElement).fontSize)}function D(t){return t=t||Z.alertBoxDiv,[t.scrollWidth,t.scrollHeight]}function E(){return[parseFloat(Z.alertBoxDiv.style.left),parseFloat(Z.alertBoxDiv.style.top)]}function m(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}function B(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}function h(t,e,n){var i=["","-o-","-ms-","-moz-","-webkit-"];for(var o in i)i.hasOwnProperty(o)&&t.style.setProperty(i[o]+e,n)}function x(t,e){t=t||Z.alertBoxDiv,e=e||.5,Q.DEBUG&$&&console.log(J+" OPACITY: "+e),t.style.opacity=e}function T(t,e){t=t||Z.alertBoxDiv;var n=e?"visible":"hidden";Q.DEBUG&$&&console.log(J+" VISIBILITY: "+n),t.style.visibility=n}function y(t,e){t=t||Z.alertBoxDiv,void 0===e&&(e=!1),Q.DEBUG&$&&console.log(J+" ENABLE: "+e+" "+t.name),t.disabled=e}function b(t,e){if(void 0===e)return t;if(!l(e)||s(e)||function(t){return"function"==typeof t}(e))return t=e;for(var n in e)if(e.hasOwnProperty(n)){if(l(e[n])&&t[n]){t[n]=b(t[n],e[n]);continue}t[n]=e[n]}return t}function A(){var t="/*Begin BAlert default CSS classes*/";for(var e in Q.defaultClasses.values)if(Q.defaultClasses.values.hasOwnProperty(e)){t+="\n.bajs_"+e+" {";var n=Q.defaultClasses.values[e].trim().split(";");for(var i in n)n[i]&&(t+="\n  "+n[i].trim()+";");t+="\n}\n"}return t+"/*End BAlert default CSS classes*/\n"}function I(t){function e(t,e,n){var r=t.attributes;if(o+=new Array(e*i).join(" ")+"<",n){for(var a="",l=0,s=r.length;l<s;l++)a+="\n"+new Array((e+1)*i).join(" ")+r[l].nodeName+"= '"+r[l].nodeValue+"'";o+=t.tagName+a}else o+="/"+t.tagName;o+=">\n"}function n(t,i){for(e(t,i,!0),t=t.firstElementChild;t;)n(t,++i),e(t,i--,!1),t=t.nextElementSibling}var i=4,o="";return n(t,0),e(t,0,!1),o}function w(){Q.callbacks.onResize&&Q.callbacks.onResize(H)}function O(t){Z.alertBoxDiv.contains(t.target)?(Q.DEBUG&$&&console.log(J+" CLICK INSIDE ALERT DETECTED"),Q.callbacks.onTapInside&&Q.callbacks.onTapInside(H)):(Q.DEBUG&$&&console.log(J+" CLICK OUTSIDE ALERT DETECTED"),Q.callbacks.onTapOutside&&Q.callbacks.onTapOutside(H))}function S(t){O(t)}function C(){"center"!==Q.position.X&&"Center"!==Q.position.X&&"C"!==Q.position.X||(Q.position.X="c"),"center"!==Q.position.Y&&"Center"!==Q.position.X&&"C"!==Q.position.X||(Q.position.Y="c"),Q.iconsPath.length>0&&"/"!==Q.iconsPath.charAt(Q.iconsPath.length-1)&&(Q.iconsPath+="/"),Q.exitButton.raw?(Q.exitButton.icon="",Q.exitButton.text=""):Q.exitButton.icon&&(Q.exitButton.text=""),Q.exitButton.icon||Q.exitButton.raw||Q.exitButton.text||(Q.exitButton.text="&times")}function N(t,e,n,i){void 0===i&&(i=""),Q.DEBUG&$&&console.log(J+" BUILDING "+e+i+" <"+n+">");var o=t.appendChild(document.createElement(n));return o.name=e+i,o.id=e+i+"_"+j,o.className=Q.defaultClasses.apply?"def_"+e+"_"+j:Q.classPrefix+e,Q.inlineStyles[e]&&(o.style.cssText+=";"+Q.inlineStyles[e]),o}function U(t,e,n){var i;void 0===n?(i=Q[e],n=""):i=Q[e][n];var o=N(t,e,"BUTTON",n);return i.raw?o.innerHTML=i.raw:(i.icon&&(Z[e+"Icon"+n]=N(o,e+"Icon","IMG",n),Z[e+"Icon"+n].src=Q.iconsPath+i.icon),i.text&&(Z[e+"Text"+n]=N(o,e+"Text","SPAN",n),Z[e+"Text"+n].innerHTML=i.text)),i.inlineStyle&&(o.style.cssText+=";"+i.inlineStyle),o.text=i.text,o.index=n,o.name=e+n,Z[e+n]=o,o.onclick=function(){Q.DEBUG&$&&console.log(J+" BUTTON PRESSED: "+e+", text='"+o.text+"', keepAlert="+(i.keepAlert?"yes":"no")+", selfDim="+(i.selfDim?"yes":"no")+", selfDisable="+(i.selfDisable?"yes":"no")+", selfHide="+(i.selfHide?"yes":"no")+", selfRemove="+(i.selfRemove?"yes":"no")+", onClick="+(i.onClick?"f() is given":"null")),i.selfDim&&x(o),i.selfDisable&&y(o,!0),i.selfHide&&T(o,!1),i.selfRemove&&setTimeout(function(){u(o)},5),i.onClick&&i.onClick(H,o),i.keepAlert||V()},o}function G(){Q.DEBUG&et&&console.log(J+" DEFAULT CSS CLASSES: \n"+A()+"\n"),Q.DEBUG&q&&console.log(J+" CONFIGURATION OPTIONS: \n"+JSON.stringify(Q,null,4)+"\n\n"),Q.DEBUG&$&&console.log(J+" DOM BUILD STARTED"),Q.defaultClasses.apply&&function(){(K=document.createElement("style")).type="text/css";var t="";for(var e in Q.defaultClasses.values)Q.defaultClasses.values.hasOwnProperty(e)&&(t+=".def_"+e+"_"+j+"{"+Q.defaultClasses.values[e]+"}\n");K.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(K),Q.DEBUG&$&&console.log(J+" BUILDING DEFAULT DOM <style>")}(),function(){var t=document.getElementsByTagName("body")[0];Z.containerDiv=N(t,"containerDiv","DIV"),Z.containerDiv.style.height=B()+"px",Z.containerDiv.style.zIndex=Q.startingZIndex+W,Z.containerDiv.style.position="absolute"}(),Z.alertBoxDiv=N(Z.containerDiv,"alertBoxDiv","DIV"),Z.alertBoxDiv.style.position="fixed",Q.exitButton.visible="function"==typeof Q.exitButton.visible?Q.exitButton.visible(H):Q.exitButton.visible,(Q.title.text||Q.title.icon||Q.title.raw||Q.exitButton.visible)&&(Z.titleDiv=N(Z.alertBoxDiv,"titleDiv","DIV"),Q.title.raw?Z.titleDiv.innerHTML=Q.title.raw:(Q.title.icon&&(Z.titleIcon=N(Z.titleDiv,"titleIcon","IMG"),Z.titleIcon.src=Q.iconsPath+Q.title.icon),Q.title.text&&(Z.titleText=N(Z.titleDiv,"titleText","SPAN"),Z.titleText.innerHTML=Q.title.text)),Q.exitButton.visible&&(Z.exitButton=U(Z.titleDiv,"exitButton"))),(Q.content.text||Q.content.raw||Q.content.icon)&&(Z.contentDiv=N(Z.alertBoxDiv,"contentDiv","DIV"),Q.content.raw?Z.contentDiv.innerHTML=Q.content.raw:(Q.content.icon&&(Z.contentIcon=N(Z.contentDiv,"contentIcon","IMG"),Z.contentIcon.src=Q.iconsPath+Q.content.icon),Q.content.text&&(Z.contentText=N(Z.contentDiv,"contentText","SPAN"),Z.contentText.innerHTML=Q.content.text))),function(){if(Z.mainButtons=[],!a(Q.mainButtons)){Z.mainButtonsDiv=N(Z.alertBoxDiv,"mainButtonsDiv","DIV");for(var t in Q.mainButtons)Q.mainButtons.hasOwnProperty(t)&&Z.mainButtons.push(U(Z.mainButtonsDiv,"mainButtons",t))}}(),Q.DEBUG&$&&console.log(J+" DOM BUILD DONE"),Q.DEBUG&tt&&console.log(J+" BROWSER DOM STRUCTURE: \n"+I(Z.containerDiv)+"\n\n"),Q.DEBUG&nt&&console.log(J+" INTERNAL DOM OBJECT STRUCTURE: \n"+JSON.stringify(Z,null,4)+"\n\n"),T(Z.alertBoxDiv,!1),k()}function k(t,e){void 0!==t&&(2===arguments.length?pos=[t,e]:pos=t,Q.DEBUG&$&&console.log(J+" REQUEST MOVE TO pos:"+JSON.stringify(pos)),Q.position.X=pos[0],Q.position.Y=pos[1]),function(){Q.position.calcX=R({raw:Q.position.X,dir:"h",negOpposite:!0}),Q.position.calcY=R({raw:Q.position.Y,dir:"v",negOpposite:!0});var t=function(){var t=BAlert.alertArray,e=t.indexOf(H),n=1,i=1,o=H.getConf("position").X,r=H.getConf("position").Y;for(;t[e-n];)o===t[e-n].getConf("position").X&&r===t[e-n].getConf("position").Y&&i++,n+=1;return i}();Q.position.calcX.val+=M({raw:Q.position.staggerX,dir:"h",negOpposite:!1,size:t}).val,Q.position.calcY.val+=M({raw:Q.position.staggerY,dir:"v",negOpposite:!1,size:t}).val,Z.alertBoxDiv.style.left=Q.position.calcX.val+Q.position.calcX.unit,Z.alertBoxDiv.style.top=Q.position.calcY.val+Q.position.calcY.unit}(),Q.DEBUG&$&&console.log(J+" MOVED TO pos: ["+Q.position.calcX.val+","+Q.position.calcY.val+"]")}function L(t){var e="h"===t.dir?m():B();return(t=function(t){if(t.alt=!1,t.isPerc=!1,t.isNeg=!1,t.sign=1,t.unit="px","string"==typeof t.raw&&(t.raw=t.raw.trim()),t.centered=function(t){return 0!==t&&!t}(t.raw)||"c"===t.raw,!t.centered){t.alt="string"==typeof t.raw&&"~"===t.raw.charAt(0),t.alt&&(t.raw=t.raw.substring(1)),t.isPerc="string"==typeof t.raw&&"%"===t.raw.slice(-1),t.isPerc&&(t.raw=t.raw.slice(0,-1)),t.isNeg="string"==typeof t.raw&&"-"===t.raw.slice(0,1)||"number"==typeof t.raw&&t.raw<0,t.sign=t.isNeg?-1:1,t.absVal=Math.abs(parseFloat(t.raw))||0;var e="string"==typeof t.raw?/(\d+\.*\d*)(\D+$)/g.exec(t.raw):null;t.unit=e&&e.length>0?e[e.length-1]:"px"}return t}(t)).centered?t.val=e/2:(t.isPerc&&(t.absVal=t.absVal*e/100),t.isNeg&&t.negOpposite?t.val=e-t.absVal:t.val=t.absVal,t.negOpposite||(t.val*=t.sign),"rem"===t.unit&&(t.val=g(t.val)),t.unit="px"),t}function R(t){var e=D(),n="h"===t.dir?e[0]:e[1];return(t=L(t)).centered?t.val=t.val-n/2:t.isNeg&&t.negOpposite&&(t.val=t.val-n),t}function M(t){return 1===(t=L(t)).size?t.val=0:t.alt?t.val=t.size%2==0?t.absVal:-t.absVal:t.val=(t.size-1)*t.absVal,t.val=t.val*t.sign,"rem"===t.unit&&(t.val=g(t.val)),t.unit="px",t}function P(t){var e,n,i=0,o=0,r=m(),a=B(),l=E(),c=l[0],u=l[1],f=D(),d=f[0],v=f[1],p=t.scale,g=c+d/2,h=u+v/2;if(s(t.dir))e=L({raw:t.dir[0],dir:"h",negOpposite:!0}).val,n=L({raw:t.dir[1],dir:"v",negOpposite:!0}).val;else switch(t.dir){case"left":e=-d*p/2,n=u+v/2;break;case"top":e=c+d/2,n=-v*p/2;break;case"right":e=r+d*p/2,n=u+v/2;break;case"bottom":e=c+d/2,n=a+v*p/2;break;case"top left":case"left top":e=-d*p/2,n=-v*p/2;break;case"top right":case"right top":e=r+d*p/2,n=-v*p/2;break;case"bottom left":case"left bottom":e=-d*p/2,n=a+v*p/2;break;case"bottom right":case"right bottom":e=r+d*p/2,n=a+v*p/2;break;case"left center":case"center left":e=-d*p/2,n=a/2;break;case"right center":case"center right":e=r+d*p/2,n=a/2;break;case"top center":case"center top":e=r/2,n=-v*p/2;break;case"bottom center":case"center bottom":e=r/2,n=a+v*p/2;break;case"center":case"center center":e=r/2,n=a/2;break;default:e=c+d/2,n=u+v/2}return i=e-g,o=n-h,Q.DEBUG&$&&console.log(J+" CALCULATED HIDING CENTER POSITION delta: ["+i+","+o+"]"),[i,o]}function X(t){return"all "+t.duration/1e3+"s "+t.func}function F(t,e){var n=X(t),i=function(t,e){return"translate("+e[0]+"px,"+e[1]+"px) scale("+t.scale+") "+(t.rotate?"rotate("+360*t.rotate+"deg)":"")}(t,e);Q.DEBUG&$&&(console.log(J+" ANIM TRANSLATION: "+JSON.stringify(e)),console.log(J+" ANIM TRANSITION: "+n),console.log(J+" ANIM TRANSFORM: "+i)),h(Z.alertBoxDiv,"transform-origin","center"),h(Z.alertBoxDiv,"transition",n),h(Z.alertBoxDiv,"transform",i)}function z(){var t=0;if(p(Q.callbacks.onDisplayBegin,"onDisplayBegin"),Q.alertStart.duration){Q.DEBUG&$&&(console.log(J+" BEGIN OF HIDE ANIMATE"),console.log(J+" CURRENT pos:"+JSON.stringify(E())),console.log(J+" CURRENT size:"+JSON.stringify(D())));var e=b({},Q.alertStart);e.rotate&&(e.rotate=-Q.alertStart.rotate),e.duration=0;var n=P(e);F(e,n),t=5,setTimeout(function(){Q.DEBUG&$&&console.log(J+" ANIMATE TO EXISTANCE ("+Q.alertStart.duration/1e3+"sec)"),T(Z.alertBoxDiv,!0);var e=X(Q.alertStart);h(Z.alertBoxDiv,"transition",e),h(Z.alertBoxDiv,"transform-origin","center"),h(Z.alertBoxDiv,"transform",""),t+=Q.alertStart.duration,setTimeout(function(){Q.DEBUG&$&&console.log(J+" END OF START ANIMATE"),h(Z.alertBoxDiv,"transition",""),v(Q.timeout),p(Q.callbacks.onDisplayEnd,"onDisplayEnd")},t)},t)}else T(Z.alertBoxDiv,!0),v(Q.timeout),p(Q.callbacks.onDisplayEnd,"onDisplayEnd");Q.callbacks.onResize&&f("resize",w),setTimeout(function(){(Q.callbacks.onTapOutside||Q.callbacks.onTapInside)&&(f("touchstart",S,{passive:!1}),f("click",O))},5)}function V(t){(t=t||Q.alertExit.delay||0)>0?(Q.DEBUG&$&&console.log(J+" DELAYED EXIT REQUESTED, delay(ms)="+t),setTimeout(function(){Y()},t)):Y()}function Y(){_=!0,Q.DEBUG&$&&console.log(J+" BEGIN OF EXIT PROCESS"),p(Q.callbacks.onExitBegin,"onExitBegin");var t=0;if(Q.alertExit.duration){Q.DEBUG&$&&console.log(J+" BEGIN OF EXIT ANIMATE ("+Q.alertExit.duration/1e3+"sec)");var e=P(Q.alertExit);F(Q.alertExit,e),t=Q.alertExit.duration}setTimeout(function(){Q.DEBUG&$&&Q.alertExit.duration&&console.log(J+" END OF EXIT ANIMATE"),Q.callbacks.onResize&&d("resize",w),(Q.callbacks.onTapOutside||Q.callbacks.onTapInside)&&d("click",O),(Q.callbacks.onTapOutside||Q.callbacks.onTapInside)&&d("touchstart",S);var t=BAlert.alertArray.indexOf(H);-1!==t&&BAlert.alertArray.splice(t,1),p(Q.callbacks.onExitEnd,"onExitEnd"),K&&(Q.DEBUG&$&&console.log(J+" DEFAULT DOM <style> REMOVED"),K.parentNode&&K.parentNode.removeChild(K)),Q.DEBUG&$&&console.log(J+" END OF EXIT"),u(Z.containerDiv),Q.DEBUG&$&&console.log(J+" DESTROYED"),_=!1},t)}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});var H=this;BAlert.alertArray=BAlert.alertArray||[];var W=a(BAlert.alertArray)?1:BAlert.alertArray.slice(-1).pop().alertNum()+1;BAlert.alertArray.push(H);var j="A"+W,J="ALERT "+W,_=!1,K=null,Q=r(),Z={};c(t)?Q.content=t:Q.content.raw=t,"number"==typeof e&&(Q.timeout=e),c(n)?Q.title=n:Q.title.raw=n,!s(i)&&c(i)&&(i=[i]),Q.mainButtons=b(Q.mainButtons,i),Q=b(Q,o);var $=1,q=2,tt=4,et=8,nt=16;this.getConf=function(t){return t?Q[t]:Q},this.setConf=function(t,e){return 1===arguments.length?Q=b(Q,t):Q[t]=b(Q[t],e),this},this.noDefaultClasses=function(){return Q.defaultClasses.apply=!1,this},this.getDefaultClasses=function(){return A()},this.setDefaultClasses=function(t,e){return 1===arguments.length?Q.defaultClasses.values=e:Q.defaultClasses.values[t]=e,this},this.setDebug=function(t){return t=t||0,Q.DEBUG=t,this},this.setIconsPath=function(t){return Q.iconsPath=t,this},this.build=function(){return C(),G(),this},this.display=function(t){return C(),function(t){t=t||Q.alertStart.delay||0,a(Z)&&G(),t?(Q.DEBUG&$&&console.log(J+" DELAYED START REQUESTED, delay(ms)="+t),setTimeout(function(){z()},t)):z()}(t),this},this.exit=function(t){return V(t),this},this.move=function(t,e){return k(t,e),this},this.enable=function(t){return y(t,!1),this},this.disable=function(t){return y(t,!0),this},this.hide=function(t){return T(t,!1),this},this.unhide=function(t){return T(t,!0),this},this.dim=function(t,e){return x(t,e),this},this.undim=function(t){return x(t,1),this},this.remove=function(t){return u(t),this},this.getPosition=function(){return E()},this.getCenterPosition=function(){return function(){var t=D(),e=E();return[e[0]+t[0]/2,e[1]+t[1]/2]}()},this.getSize=function(){return D()},this.getStructure=function(t){return t=t||Z.containerDiv,I(t)},this.getElement=function(t){return t=t||"alertBoxDiv",Z[t]},this.merge=function(t,e){return b(t,e)},this.setCrossBrowserStyle=function(t,e,n){return h(t,e,n),this},this.reset=function(){return Q=r(),Z={},this},this.version=function(){return"2.1"},this.alertNum=function(){return W},this.conf=Q,this.DOM=Z};